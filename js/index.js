let bookset =
  [
    {
      "bookName": "To Kill a Mockingbird",
      "authorName": "Harper Lee",
      "rating": 4.8,
      "coverPhoto": "./img/Img/Img/Tokillamockingbird.jpeg",
      "genre": "Fiction",
      "isEditing": false,
    },
    {
      "bookName": "1984",
      "authorName": "George Orwell",
      "rating": 4.7,
      "coverPhoto": "./img/Img/Img/GeorgOrwell1984.jpeg",
      "genre": "Dystopian",
      "isEditing": false
    },
    {
      "bookName": "Pride and Prejudice",
      "authorName": "Jane Austen",
      "rating": 4.6,
      "coverPhoto": "./img/Img/Img/Pride&Prejudice.jpeg",
      "genre": "Romance",
      "isEditing": false
    },
    {
      "bookName": "The Great Gatsby",
      "authorName": "F. Scott Fitzgerald",
      "rating": 4.5,
      "coverPhoto": "./img/Img/Img/Thegreatgatsby.jpg",
      "genre": "Classic",
      "isEditing": false
    },
    {
      "bookName": "Moby Dick",
      "authorName": "Herman Melville",
      "rating": 4.4,
      "coverPhoto": "./img/Img/Img/Moby-Dick.jpeg",
      "genre": "Adventure",
      "isEditing": false
    },
    {
      "bookName": "The Catcher in the Rye",
      "authorName": "J.D. Salinger",
      "rating": 4.3,
      "coverPhoto": "./img/Img/Img/TheCatcherintheRay.jpeg",
      "genre": "Fiction",
      "isEditing": false
    },
    {
      "bookName": "Brave New World",
      "authorName": "Aldous Huxley",
      "rating": 4.2,
      "coverPhoto": "./img/Img/Img/BraveNewWorld.jpeg",
      "genre": "Dystopian",
      "isEditing": false
    },
    {
      "bookName": "Wuthering Heights",
      "authorName": "Emily BrontÃ«",
      "rating": 4.1,
      "coverPhoto": "./img/Img/Img/WutheringHeight.jpeg",
      "genre": "Romance",
      "isEditing": false
    },
    {
      "bookName": "War and Peace",
      "authorName": "Leo Tolstoy",
      "rating": 4.0,
      "coverPhoto": "./img/Img/Img/Warandpeace.jpeg",
      "genre": "Historical",
      "isEditing": false
    },
    {
      "bookName": "The Odyssey",
      "authorName": "Homer",
      "rating": 4.0,
      "coverPhoto": "./img/Img/Img/TheOdssey.jpeg",
      "genre": "Epic",
      "isEditing": false
    },
    {
      "bookName": "The Hobbit",
      "authorName": "J.R.R. Tolkien",
      "rating": 4.9,
      "coverPhoto": "./img/Img/Img/TheHobbit.jpeg",
      "genre": "Fantasy",
      "isEditing": false
    },
    {
      "bookName": "Harry Potter and the Sorcerer's Stone",
      "authorName": "J.K. Rowling",
      "rating": 4.8,
      "coverPhoto": "./img/Img/Img/HarryPotter.jpeg",
      "genre": "Fantasy",
      "isEditing": false
    },
    {
      "bookName": "The Fellowship of the Ring",
      "authorName": "J.R.R. Tolkien",
      "rating": 4.8,
      "coverPhoto": "./img/Img/Img/Thelordofthering.jpg",
      "genre": "Fantasy",
      "isEditing": false
    },
    {
      "bookName": "The Lion, the Witch and the Wardrobe",
      "authorName": "C.S. Lewis",
      "rating": 4.7,
      "coverPhoto": "./img/Img/Img/ThewitchandtheWar.jpeg",
      "genre": "Fantasy",
      "isEditing": false
    },
    {
      "bookName": "A Game of Thrones",
      "authorName": "George R.R. Martin",
      "rating": 4.7,
      "coverPhoto": "./img/Img/Img/TheGameofThrone.jpeg",
      "genre": "Fantasy",
      "isEditing": false
    },
    {
      "bookName": "The Da Vinci Code",
      "authorName": "Dan Brown",
      "rating": 4.6,
      "coverPhoto": "./img/Img/Img/TheDevinceCode.jpeg",
      "genre": "Thriller",
      "isEditing": false
    },
    {
      "bookName": "Gone Girl",
      "authorName": "Gillian Flynn",
      "rating": 4.5,
      "coverPhoto": "./img/Img/Img/GoneGirl.jpeg",
      "genre": "Thriller",
      "isEditing": false
    },
    {
      "bookName": "The Girl with the Dragon Tattoo",
      "authorName": "Stieg Larsson",
      "rating": 4.5,
      "coverPhoto": "./img/Img/Img/ThewiththeDragontattoo.jpeg",
      "genre": "Thriller",
      "isEditing": false
    },
    {
      "bookName": "The Shining",
      "authorName": "Stephen King",
      "rating": 4.4,
      "coverPhoto": "./img/Img/Img/Theshining.jpeg",
      "genre": "Horror",
      "isEditing": false
    },
    {
      "bookName": "Dracula",
      "authorName": "Bram Stoker",
      "rating": 4.3,
      "coverPhoto": "./img/Img/Img/Dracula.jpeg",
      "genre": "Horror",
      "isEditing": false
    },
    {
      "bookName": "Frankenstein",
      "authorName": "Mary Shelley",
      "rating": 4.2,
      "coverPhoto": "./img/Img/Img/Frankenstein.jpeg",
      "genre": "Horror",
      "isEditing": false
    },
    {
      "bookName": "The Exorcist",
      "authorName": "William Peter Blatty",
      "rating": 4.1,
      "coverPhoto": "./img/Img/Img/TheExorcist.jpeg",
      "genre": "Horror",
      "isEditing": false
    },
    {
      "bookName": "The Haunting of Hill House",
      "authorName": "Shirley Jackson",
      "rating": 4.0,
      "coverPhoto": "./img/Img/Img/ThehauntingofHill.jpeg",
      "genre": "Horror",
      "isEditing": false
    },
    {
      "bookName": "The Road",
      "authorName": "Cormac McCarthy",
      "rating": 4.0,
      "coverPhoto": "./img/Img/Img/TheRoad.jpeg",
      "genre": "Post-Apocalyptic",
      "isEditing": false
    },
    {
      "bookName": "The Handmaid's Tale",
      "authorName": "Margaret Atwood",
      "rating": 4.8,
      "coverPhoto": "./img/Img/Img/TheHandMaidTail.jpeg",
      "genre": "Dystopian",
      "isEditing": false
    },
    {
      "bookName": "Fahrenheit 451",
      "authorName": "Ray Bradbury",
      "rating": 4.7,
      "coverPhoto": "./img/Img/Img/451.jpeg",
      "genre": "Dystopian",
      "isEditing": false
    },
    {
      "bookName": "The Hunger Games",
      "authorName": "Suzanne Collins",
      "rating": 4.6,
      "coverPhoto": "./img/Img/Img/TheHungerMan.jpeg",
      "genre": "Dystopian",
      "isEditing": false
    },
    {
      "bookName": "Divergent",
      "authorName": "Veronica Roth",
      "rating": 4.5,
      "coverPhoto": "./img/Img/Img/Divergent.jpeg",
      "genre": "Dystopian",
      "isEditing": false
    },
    {
      "bookName": "The Maze Runner",
      "authorName": "James Dashner",
      "rating": 4.4,
      "coverPhoto": "./img/Img/Img/TheMazeRunner.jpeg",
      "genre": "Dystopian",
      "isEditing": false
    },
    {
      "bookName": "The Alchemist",
      "authorName": "Paulo Coelho",
      "rating": 4.3,
      "coverPhoto": "./img/Img/Img/TheAlchemist.jpeg",
      "genre": "Philosophical",
      "isEditing": false
    },
    {
      "bookName": "Siddhartha",
      "authorName": "Hermann Hesse",
      "rating": 4.2,
      "coverPhoto": "./img/Img/Img/Siddhartha.jpeg",
      "genre": "Philosophical",
      "isEditing": false
    },
    {
      "bookName": "The Prophet",
      "authorName": "Kahlil Gibran",
      "rating": 4.1,
      "coverPhoto": "./img/Img/Img/Theprofit.jpeg",
      "genre": "Philosophical",
      "isEditing": false
    },
    {
      "bookName": "Zen and the Art of Motorcycle Maintenance",
      "authorName": "Robert M. Pirsig",
      "rating": 4.0,
      "coverPhoto": "./img/Img/Img/Theartofmotorcycle.jpeg",
      "genre": "Philosophical",
      "isEditing": false
    },
    {
      "bookName": "The Art of War",
      "authorName": "Sun Tzu",
      "rating": 4.0,
      "coverPhoto": "./img/Img/Img/Theartofthewar.jpeg",
      "genre": "Philosophical",
      "isEditing": false
    }
  ];
let books = JSON.parse(localStorage.getItem('books')) || bookset;


function saveBooks() {
  localStorage.setItem('books', JSON.stringify(books));
  bookset.push(books);
}



sessionStorage.setItem("islogged", "false");
const btndisplay = document.querySelectorAll(".afterlogin");
const btnhide = document.getElementById("login")
const btnlogout = document.getElementById("logout")
const loginform = document.getElementById('container2');
const closelogin = document.getElementById('closepop');
const managebtn = document.getElementById('manage');
const managebox = document.getElementById('manageBox');
const mainpage = document.getElementById('mainpage')
const addbookpop = document.getElementById('addbookblock');
const addbookbtn = document.getElementById('addBook');
const homebtn = document.getElementById('home');
const contactbtn = document.getElementById('contact');
const contactblock = document.getElementById('contactus');


function addBook() {
  let bookName = document.getElementById('addinput1').value;
  let bookCover = document.getElementById('addinput2').files[0];
  let bookAuthor = document.getElementById('addinput3').value;
  let bookrating = document.getElementById('addinput4').value;
  let bookGenre = document.getElementById('addinput5').value;
  console.log("books added");
  if (bookName !== '' && bookAuthor !== '') {
    const reader = new FileReader();
    reader.onload = function (e) {
      console.log("annoymous function");
      const book = {

        bookName: bookName,
        authorName: bookAuthor,
        rating: bookrating,
        genre: bookGenre,
        coverPhoto: e.target.result,
        isEditing: false
      };
      books.push(book);
      // document.getElementById('bookTitle').value = '';
      // document.getElementById('bookAuthor').value = '';
      // document.getElementById('bookDate').value = '';
      // document.getElementById('bookCover').value = '';
      bookName = '';
      bookAuthor = '';
      bookCover = '';
      bookGenre = '';
      bookrating = '';
      saveBooks();
      renderBooks();
    };
    reader.readAsDataURL(bookCover);
    addbookpop.style.display = "none";
  }
}


function deleteBook(index) {
  books.splice(index, 1);
  saveBooks();
  renderBooks();
}

function editBook(index) {
  books[index].isEditing = !books[index].isEditing;
  renderBooks();
}

function saveBook(index) {
  console.log("save it");
  const editTitle = document.getElementById(`editTitle-${index}`).value.trim();
  const editAuthor = document.getElementById(`editAuthor-${index}`).value.trim();
  const editRating = document.getElementById(`editRating-${index}`).value.trim();
  const editGenre = document.getElementById(`editGenre-${index}`).value.trim();
  const editCover = document.getElementById(`editCover-${index}`).files[0];

  if (editTitle !== '' && editAuthor !== '') {
    if (editCover) {
      const reader = new FileReader();
      reader.onload = function (e) {
        books[index].coverPhoto = e.target.result;
        books[index].title = editTitle;
        books[index].author = editAuthor;
        books[index].rating = editRating;
        books[index].genre = editGenre;

        books[index].isEditing = false;
        saveBooks();
        renderBooks();
      };
      reader.readAsDataURL(editCover);
    } else {
      books[index].title = editTitle;
      books[index].author = editAuthor;
      books[index].rating = editRating;
      books[index].genre = editGenre;
      books[index].isEditing = false;
      saveBooks();
      renderBooks();
    }
  }
}

function renderBooks() {
  console.log("render function");
  const bookTableBody = document.querySelector('#manageBox tbody');
  bookTableBody.innerHTML = '';
  books.forEach((book, index) => {
    const row = document.createElement('tr');
    if (book.isEditing) {
      row.innerHTML = `
                <td><input type="file" id="editCover-${index}" accept="image/*"></td>
                <td><input type="text" id="editTitle-${index}" value="${book.bookName}"></td>
                <td><input type="text" id="editAuthor-${index}" value="${book.authorName}"></td>
                <td><input type="text" id="editGenre-${index}" value="${book.genre}"></td>
                <td><input type="number" id="editRating-${index}" value="${book.rating}"></td>
                
                <td>
                    <button class="btntab" onclick="saveBook(${index})"><i class="fa-solid fa-check fa-lg"></i></button>
                    <button class="btntab" onclick="editBook(${index})"><i class="fa-solid fa-xmark fa-lg"></i></button>
                </td>
            `;
    } else {
      console.log("printing data");
      row.innerHTML = `
                <td><img src="${book.coverPhoto}" alt="Cover Image" style="width: 50px; height: 75px;"></td>
                <td>${book.bookName}</td>
                <td>${book.authorName}</td>
                <td>${book.rating}</td>
                <td>${book.genre}</td>

                <td>
                    <button class="btntab" onclick="editBook(${index})"><i class="fa-solid fa-pen-to-square fa-lg"></i></button>
                    <button class="btntab" onclick="deleteBook(${index})"><i class="fa-solid fa-trash fa-lg"></i></button>
                </td>
            `;
    }
    bookTableBody.appendChild(row);
  });

}

function logged() {
  console.log("pressed");
  loginform.classList.add('active');
}

btnlogout.addEventListener("click", () => {
  sessionStorage.setItem("islogged", "false");
  history.go(0);
})

function authenticate() {
  const user = document.getElementById('username');
  const pass = document.getElementById('pwd');

  if (user.value === "admin" && pass.value === "admin123") {
    sessionStorage.setItem("islogged", "true");
    btndisplay.forEach(element => {
      element.classList.add('afterloginbtn');
    });
    btnhide.style.display = "none";
    loginform.style.display = "none";
  }
  else {
    alert("Wrong credentials");
  }
}

function closePopup() {
  loginform.classList.remove('active');
}

window.addEventListener('click', function (event) {
  console.log(event.target);
  const isClickInside = loginform.contains(event.target) || event.target.matches('button[onclick="logged()"]');
  if (loginform.classList.contains('active') && !isClickInside) {
    closePopup();
  }
})


function manage() {
  managebox.style.display = 'flex';
  mainpage.style.display = 'none';
  contactblock.style.display = "none";
  renderBooks();

}

addbookbtn.addEventListener('click', () => {
  addbookpop.style.display = 'flex';
  console.log("addbtn");
})

function goBack() {
  addbookpop.style.display = 'none';
}

homebtn.addEventListener('click', () => {
  window.location.href = 'index.html';
})

contactbtn.addEventListener('click', (event) => {
  contactblock.style.display = "flex";
  managebox.style.display = 'none';
  mainpage.style.display = 'flex';
  event.preventDefault();
  document.getElementById('contactus').scrollIntoView({ behavior: 'smooth' });
});

function borrow(index) {
  const bookborrow = books[index];
  // localStorage.setItem('borrowedBook', JSON.stringify(bookborrow));
  window.open("borrow.html");
}

function displaybooks(filterGenre='All') {
  console.log("hello");
  const bookCard = document.querySelector('.container');
  bookCard.innerHTML='';
  books.forEach((book, index) => {
    if (filterGenre !== 'All' && filterGenre !== 'Others' && book.genre !== filterGenre) return;
    if (filterGenre === 'Others' && (book.genre === 'Fiction' || book.genre === 'Romance' ||book.genre==='Classic'||book.genre==='Adventure'||book.genre==='Fantasy'||book.genre=='Thriller'||book.genre==='Horror')) return;
    const card = document.createElement('div');
    card.className = "card";
    card.innerHTML = `
     <div class="card-image" style="background-image: url(${book.coverPhoto}) ;">
     </div>
          <p>${book.bookName}</p>
            
          <p>${book.rating}</p>
          <button onclick="borrow(${index})" id="borrowbtn">Borrow</button>
              
              `;
    bookCard.appendChild(card);
  })
}

function filtergen(genre){
  displaybooks(genre);
}
displaybooks();
